<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping List Search</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XKWL83Y7R6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XKWL83Y7R6');
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/5.0.2/tesseract.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', Courier, monospace !important;
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 600px;
            transform: translateY(0);
            transition: transform 0.3s ease;
            border: 3px solid #8B0000;
        }

        .container:hover {
            transform: translateY(-5px);
        }

        h1 {
            text-align: center;
            color: #000000 !important;
            margin-bottom: 30px;
            font-size: 2.2em;
            font-weight: 700;
            font-family: 'Courier New', Courier, monospace !important;
        }

        .instructions {
            background: rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 4px solid #8B0000;
        }

        .instructions p {
            color: #000000 !important;
            line-height: 1.6;
            margin-bottom: 10px;
            font-family: 'Courier New', Courier, monospace !important;
        }

        .instructions p:last-child {
            margin-bottom: 0;
        }

        .input-section {
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #000000 !important;
            font-size: 1.1em;
            font-family: 'Courier New', Courier, monospace !important;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 3px solid #000000;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Courier New', Courier, monospace !important;
            resize: vertical;
            transition: all 0.3s ease;
            background: #ffffff;
            color: #000000;
        }

        textarea:focus {
            outline: none;
            border-color: #8B0000;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.2);
        }

        .store-sections {
            margin: 30px 0;
        }

        .store-section {
            background: rgba(0, 0, 0, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid #000000;
            transition: all 0.3s ease;
        }

        .store-section:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .store-section h2 {
            margin-bottom: 15px;
            color: #000000 !important;
            font-size: 1.3em;
            text-align: center;
            font-family: 'Courier New', Courier, monospace !important;
        }

        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, #8B0000, #A52A2A);
            color: white !important;
            border: 3px solid #000000;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Courier New', Courier, monospace !important;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
            min-width: 140px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 0, 0, 0.4);
            background: linear-gradient(135deg, #A52A2A, #8B0000);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #666666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .clear-btn {
            background: linear-gradient(135deg, #000000, #333333) !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .clear-btn:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #333333, #000000) !important;
        }

        .wholefoods-btn {
            background: linear-gradient(135deg, #8B0000, #A52A2A) !important;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
        }

        .wholefoods-btn:hover {
            box-shadow: 0 8px 25px rgba(139, 0, 0, 0.4);
            background: linear-gradient(135deg, #A52A2A, #8B0000) !important;
        }

        .amazon-btn {
            background: linear-gradient(135deg, #FF9900, #FF7700) !important;
            box-shadow: 0 4px 15px rgba(255, 153, 0, 0.3);
            color: #000000 !important;
        }

        .amazon-btn:hover {
            box-shadow: 0 8px 25px rgba(255, 153, 0, 0.4);
            background: linear-gradient(135deg, #FF7700, #FF9900) !important;
        }

        .target-btn {
            background: linear-gradient(135deg, #CC0000, #E50000) !important;
            box-shadow: 0 4px 15px rgba(204, 0, 0, 0.3);
        }

        .target-btn:hover {
            box-shadow: 0 8px 25px rgba(204, 0, 0, 0.4);
            background: linear-gradient(135deg, #E50000, #CC0000) !important;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            font-family: 'Courier New', Courier, monospace !important;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }

        .status.show {
            opacity: 1;
            transform: translateY(0);
        }

        .status.success {
            background: rgba(0, 0, 0, 0.1);
            color: #000000 !important;
            border: 3px solid #000000;
        }

        .status.error {
            background: rgba(139, 0, 0, 0.1);
            color: #8B0000 !important;
            border: 3px solid #8B0000;
        }

        .drop-zone {
            border: 3px dashed #8B0000;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            background: rgba(139, 0, 0, 0.05);
            transition: all 0.3s ease;
            font-family: 'Courier New', Courier, monospace !important;
        }

        .drop-zone.dragover {
            background: rgba(139, 0, 0, 0.1);
            border-color: #000000;
        }

        .drop-zone p {
            color: #000000 !important;
            margin: 10px 0;
            font-family: 'Courier New', Courier, monospace !important;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #8B0000, #A52A2A) !important;
            color: white !important;
            border: 3px solid #000000;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', Courier, monospace !important;
            cursor: pointer;
            margin: 10px;
        }

        .upload-btn:hover {
            background: linear-gradient(135deg, #A52A2A, #8B0000) !important;
        }

        .processing {
            background: rgba(0, 0, 0, 0.1);
            color: #000000 !important;
            border: 3px solid #000000;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', Courier, monospace !important;
        }

        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
                margin: 10px;
            }

            h1 {
                font-size: 1.8em;
            }

            .button-container {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🛒 Shopping List Search</h1>
        
        <div class="instructions">
            <p><strong>How to use:</strong> Enter your shopping items one per line in the text area below, then choose which store to search.</p>
            <p>You can also drag and drop an image of your handwritten shopping list for automatic OCR text extraction!</p>
            <p><strong>Shopping process:</strong> When you click a search button, a new tab will open up for every item on your list. You just need to add an item to your shopping cart on each tab, then close it. When you get to the last tab, you should have a full shopping cart, and you can check out.</p>
            <p><strong>Important:</strong> You must allow pop-ups from this site in order to use it properly. <a href="https://support.google.com/chrome/answer/95472" target="_blank" style="color: #8B0000; text-decoration: underline;">Click here for help allowing pop-ups in Chrome</a>.</p>
        </div>

        <div class="drop-zone" id="dropZone">
            <p><strong>📷 Drag & Drop Image OCR</strong></p>
            <p>Drag an image of your shopping list here, or click to upload</p>
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">Choose Image</button>
            <input type="file" id="fileInput" class="file-input" accept="image/*" onchange="handleFileSelect(this.files[0])">
        </div>

        <div id="processingStatus"></div>

        <div class="input-section">
            <label for="groceryList">Enter shopping items (one per line):</label>
            <textarea
                id="groceryList"
                placeholder="organic bananas&#10;bluetooth headphones&#10;olive oil&#10;phone charger&#10;fresh salmon"></textarea>
        </div>

        <div class="store-sections">
            <div class="store-section">
                <h2>🏪 Costco SameDay</h2>
                <div class="button-container">
                    <button onclick="searchCostco()">Search Costco</button>
                </div>
            </div>

            <div class="store-section">
                <h2>🥬 Whole Foods (Amazon)</h2>
                <div class="button-container">
                    <button onclick="searchWholeFoods()" class="wholefoods-btn">Search Whole Foods</button>
                </div>
            </div>

            <div class="store-section">
                <h2>📦 Amazon</h2>
                <div class="button-container">
                    <button onclick="searchAmazon()" class="amazon-btn">Search Amazon</button>
                </div>
            </div>

            <div class="store-section">
                <h2>🎯 Target</h2>
                <div class="button-container">
                    <button onclick="searchTarget()" class="target-btn">Search Target</button>
                </div>
            </div>
        </div>

        <div class="button-container">
            <button class="clear-btn" onclick="clearList()">Clear List</button>
        </div>

        <div id="status" class="status"></div>
    </div>

    <script>
        // OCR and file handling functions
        async function processImageOCR(file) {
            const processingDiv = document.getElementById('processingStatus');
            processingDiv.innerHTML = '<div class="processing">🔍 Processing image with OCR... This may take a moment.</div>';
            
            try {
                const result = await Tesseract.recognize(file, 'eng', {
                    logger: m => {
                        if (m.status === 'recognizing text') {
                            const progress = Math.round(m.progress * 100);
                            processingDiv.innerHTML = `<div class="processing">🔍 Processing OCR... ${progress}%</div>`;
                        }
                    }
                });
                
                const extractedText = result.data.text;
                const textarea = document.getElementById('groceryList');
                
                // Clean up the OCR text - split by lines and filter out empty/very short lines
                const cleanedLines = extractedText
                    .split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 2) // Filter out very short lines that might be OCR artifacts
                    .join('\n');
                
                textarea.value = cleanedLines;
                
                processingDiv.innerHTML = '<div class="processing">✅ OCR complete! Text extracted and added to the list.</div>';
                setTimeout(() => {
                    processingDiv.innerHTML = '';
                }, 3000);
                
            } catch (error) {
                console.error('OCR Error:', error);
                processingDiv.innerHTML = '<div class="processing" style="color: #8B0000;">❌ Error processing image. Please try again or enter text manually.</div>';
                setTimeout(() => {
                    processingDiv.innerHTML = '';
                }, 5000);
            }
        }

        function handleFileSelect(file) {
            if (file && file.type.startsWith('image/')) {
                processImageOCR(file);
            } else {
                showStatus('Please select a valid image file.', 'error');
            }
        }

        // Drag and drop functionality
        const dropZone = document.getElementById('dropZone');
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        // Existing search functions
        function searchCostco() {
            searchStore('costco');
        }

        function searchWholeFoods() {
            searchStore('wholefoods');
        }

        function searchAmazon() {
            searchStore('amazon');
        }

        function searchTarget() {
            searchStore('target');
        }

        function searchStore(store) {
            const textarea = document.getElementById('groceryList');
            const items = textarea.value
                .split('\n')
                .map(item => item.trim())
                .filter(item => item.length > 0);

            if (items.length === 0) {
                showStatus('Please enter at least one shopping item.', 'error');
                return;
            }

            // Show success message
            const storeNames = {
                'costco': 'Costco SameDay',
                'wholefoods': 'Whole Foods',
                'amazon': 'Amazon',
                'target': 'Target'
            };
            const storeName = storeNames[store];
            showStatus(`Opening ${items.length} ${storeName} search tab${items.length === 1 ? '' : 's'}...`, 'success');

            // Try opening all tabs immediately (better chance of working)
            let blockedCount = 0;
            items.forEach((item, index) => {
                let searchUrl;
                if (store === 'costco') {
                    searchUrl = `https://sameday.costco.com/store/costco/s?k=${encodeURIComponent(item)}`;
                } else if (store === 'wholefoods') {
                    searchUrl = `https://www.amazon.com/s?k=${encodeURIComponent(item)}&i=wholefoods&rh=n%3A18473610011`;
                } else if (store === 'amazon') {
                    searchUrl = `https://www.amazon.com/s?k=${encodeURIComponent(item)}`;
                } else if (store === 'target') {
                    searchUrl = `https://www.target.com/s?searchTerm=${encodeURIComponent(item)}`;
                }
                
                try {
                    const newTab = window.open(searchUrl, '_blank');
                    if (!newTab || newTab.closed || typeof newTab.closed == 'undefined') {
                        blockedCount++;
                        console.log(`Tab blocked for: ${item}`);
                    }
                } catch (error) {
                    blockedCount++;
                    console.log(`Error opening tab for ${item}:`, error);
                }
            });

            if (blockedCount > 0) {
                showStatus(`${blockedCount} tabs were blocked. Please allow pop-ups and try again.`, 'error');
            }
        }

        function clearList() {
            document.getElementById('groceryList').value = '';
            showStatus('List cleared!', 'success');
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type} show`;
            
            setTimeout(() => {
                statusDiv.classList.remove('show');
            }, 3000);
        }

        // Allow Enter key to search when textarea is focused
        document.getElementById('groceryList').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                searchAllItems();
            }
        });
    </script>
</body>
</html>
